version: '3.8'

services:
  flutter-builder:
    build: .
    volumes:
      - .:/app
      - flutter-cache:/root/.flutter
    working_dir: /app
    command: >
      bash -c "
        echo '🌱 ФЕРМЕРСКИЙ МАРКЕТПЛЕЙС - СБОРКА APK' &&
        echo '============================================================' &&
        echo '📦 Устанавливаем зависимости...' &&
        flutter pub get &&
        echo '🏗️ Собираем APK...' &&
        flutter build apk --release &&
        echo '✅ APK собран успешно!' &&
        echo '📱 Файл: build/app/outputs/flutter-apk/app-release.apk' &&
        echo '📏 Размер: ~15-20 MB' &&
        echo '📱 Совместимость: Android 5.0+' &&
        echo '🎉 ГОТОВО!'
      "
    environment:
      - FLUTTER_ROOT=/flutter
      - PATH=/flutter/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin

volumes:
  flutter-cache:
